"use strict";(self.webpackChunkmy_webpack_vue=self.webpackChunkmy_webpack_vue||[]).push([[843],{4130:(t,e,i)=>{i.r(e),i.d(e,{default:()=>L});var o=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"three"},[o("ThreeView",{staticClass:"three-box",style:{filter:t.dialogVisible?"blur(10px)":""},attrs:{modelUrl:t.modelUrl,sceneBg:t.BG,autoRotate:t.autoRotate}}),t._v(" "),o("div",{staticClass:"title"},[o("div",{staticClass:"content"},[o("div",{staticClass:"_title"},[t._v(t._s(t.modelText.title))]),t._v(" "),t.showTip?t._e():o("div",[o("img",{staticClass:"pointer",attrs:{src:i(693),alt:""},on:{click:function(e){t.showTip=!0}}})]),t._v(" "),t.showTip?o("div",[o("div",{staticClass:"_sub-title"},[t._v(t._s(t.modelText.subTitle))]),t._v(" "),o("div",[o("img",{staticClass:"pointer",attrs:{src:i(9389),alt:""},on:{click:function(e){t.showTip=!1}}})])]):t._e()])]),t._v(" "),t._m(0),t._v(" "),o("div",{staticClass:"action"},[o("img",{staticClass:"auto-icon",attrs:{src:i(4828),alt:""},on:{click:function(e){t.autoRotate=!t.autoRotate}}}),t._v(" "),o("img",{staticClass:"help-icon",attrs:{src:i(3421),alt:""},on:{click:function(e){t.dialogVisible=!0}}})]),t._v(" "),o("div",{staticClass:"close pointer"},[o("img",{attrs:{src:i(2266),alt:""},on:{click:function(e){return t.close()}}})]),t._v(" "),o("Tutorial",{model:{value:t.dialogVisible,callback:function(e){t.dialogVisible=e},expression:"dialogVisible"}})],1)},s=[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"logo"},[e("img",{attrs:{src:i(4427),alt:""}})])}];o._withStripped=!0;var n=i(6927),r=function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"threejs-container"})};r._withStripped=!0;var a=i(1012),l=i(1855);function c(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function h(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var u=i(7037),d=i(9401);const p=/^[og]\s*(.+)?/,m=/^mtllib /,f=/^usemtl /,g=/^usemap /,v=new a.Pa4,b=new a.Pa4,y=new a.Pa4,w=new a.Pa4,x=new a.Pa4,j=new a.Ilk;function C(){const t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);const i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(t,e){const i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);const o={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){const e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(o),o},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){const e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(let t=this.materials.length-1;t>=0;t--)this.materials[t].groupCount<=0&&this.materials.splice(t,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},i&&i.name&&"function"==typeof i.clone){const t=i.clone(0);t.inherited=!0,this.object.materials.push(t)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){const i=parseInt(t,10);return 3*(i>=0?i-1:i+e/3)},parseNormalIndex:function(t,e){const i=parseInt(t,10);return 3*(i>=0?i-1:i+e/3)},parseUVIndex:function(t,e){const i=parseInt(t,10);return 2*(i>=0?i-1:i+e/2)},addVertex:function(t,e,i){const o=this.vertices,s=this.object.geometry.vertices;s.push(o[t+0],o[t+1],o[t+2]),s.push(o[e+0],o[e+1],o[e+2]),s.push(o[i+0],o[i+1],o[i+2])},addVertexPoint:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,i){const o=this.normals,s=this.object.geometry.normals;s.push(o[t+0],o[t+1],o[t+2]),s.push(o[e+0],o[e+1],o[e+2]),s.push(o[i+0],o[i+1],o[i+2])},addFaceNormal:function(t,e,i){const o=this.vertices,s=this.object.geometry.normals;v.fromArray(o,t),b.fromArray(o,e),y.fromArray(o,i),x.subVectors(y,b),w.subVectors(v,b),x.cross(w),x.normalize(),s.push(x.x,x.y,x.z),s.push(x.x,x.y,x.z),s.push(x.x,x.y,x.z)},addColor:function(t,e,i){const o=this.colors,s=this.object.geometry.colors;void 0!==o[t]&&s.push(o[t+0],o[t+1],o[t+2]),void 0!==o[e]&&s.push(o[e+0],o[e+1],o[e+2]),void 0!==o[i]&&s.push(o[i+0],o[i+1],o[i+2])},addUV:function(t,e,i){const o=this.uvs,s=this.object.geometry.uvs;s.push(o[t+0],o[t+1]),s.push(o[e+0],o[e+1]),s.push(o[i+0],o[i+1])},addDefaultUV:function(){const t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){const e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,i,o,s,n,r,a,l){const c=this.vertices.length;let h=this.parseVertexIndex(t,c),u=this.parseVertexIndex(e,c),d=this.parseVertexIndex(i,c);if(this.addVertex(h,u,d),this.addColor(h,u,d),void 0!==r&&""!==r){const t=this.normals.length;h=this.parseNormalIndex(r,t),u=this.parseNormalIndex(a,t),d=this.parseNormalIndex(l,t),this.addNormal(h,u,d)}else this.addFaceNormal(h,u,d);if(void 0!==o&&""!==o){const t=this.uvs.length;h=this.parseUVIndex(o,t),u=this.parseUVIndex(s,t),d=this.parseUVIndex(n,t),this.addUV(h,u,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";const e=this.vertices.length;for(let i=0,o=t.length;i<o;i++){const o=this.parseVertexIndex(t[i],e);this.addVertexPoint(o),this.addColor(o)}},addLineGeometry:function(t,e){this.object.geometry.type="Line";const i=this.vertices.length,o=this.uvs.length;for(let e=0,o=t.length;e<o;e++)this.addVertexLine(this.parseVertexIndex(t[e],i));for(let t=0,i=e.length;t<i;t++)this.addUVLine(this.parseUVIndex(e[t],o))}};return t.startObject("",!1),t}class V extends a.aNw{constructor(t){super(t),this.materials=null}load(t,e,i,o){const s=this,n=new a.hH6(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(t,(function(i){try{e(s.parse(i))}catch(e){o&&o(e),s.manager.itemError(t)}}),i,o)}setMaterials(t){return this.materials=t,this}parse(t){const e=new C;-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),-1!==t.indexOf("\\\n")&&(t=t.replace(/\\\n/g,""));const i=t.split("\n");let o="",s="",n=0,r=[];const l="function"==typeof"".trimLeft;for(let t=0,a=i.length;t<a;t++)if(o=i[t],o=l?o.trimLeft():o.trim(),n=o.length,0!==n&&(s=o.charAt(0),"#"!==s))if("v"===s){const t=o.split(/\s+/);switch(t[0]){case"v":e.vertices.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),t.length>=7?(j.setRGB(parseFloat(t[4]),parseFloat(t[5]),parseFloat(t[6])).convertSRGBToLinear(),e.colors.push(j.r,j.g,j.b)):e.colors.push(void 0,void 0,void 0);break;case"vn":e.normals.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));break;case"vt":e.uvs.push(parseFloat(t[1]),parseFloat(t[2]))}}else if("f"===s){const t=o.slice(1).trim().split(/\s+/),i=[];for(let e=0,o=t.length;e<o;e++){const o=t[e];if(o.length>0){const t=o.split("/");i.push(t)}}const s=i[0];for(let t=1,o=i.length-1;t<o;t++){const o=i[t],n=i[t+1];e.addFace(s[0],o[0],n[0],s[1],o[1],n[1],s[2],o[2],n[2])}}else if("l"===s){const t=o.substring(1).trim().split(" ");let i=[];const s=[];if(-1===o.indexOf("/"))i=t;else for(let e=0,o=t.length;e<o;e++){const o=t[e].split("/");""!==o[0]&&i.push(o[0]),""!==o[1]&&s.push(o[1])}e.addLineGeometry(i,s)}else if("p"===s){const t=o.slice(1).trim().split(" ");e.addPointGeometry(t)}else if(null!==(r=p.exec(o))){const t=(" "+r[0].slice(1).trim()).slice(1);e.startObject(t)}else if(f.test(o))e.object.startMaterial(o.substring(7).trim(),e.materialLibraries);else if(m.test(o))e.materialLibraries.push(o.substring(7).trim());else if(g.test(o));else if("s"===s){if(r=o.split(" "),r.length>1){const t=r[1].trim().toLowerCase();e.object.smooth="0"!==t&&"off"!==t}else e.object.smooth=!0;const t=e.object.currentMaterial();t&&(t.smooth=e.object.smooth)}else if("\0"===o)continue;e.finalize();const c=new a.ZAu;c.materialLibraries=[].concat(e.materialLibraries);if(!0===!(1===e.objects.length&&0===e.objects[0].geometry.vertices.length))for(let t=0,i=e.objects.length;t<i;t++){const i=e.objects[t],o=i.geometry,s=i.materials,n="Line"===o.type,r="Points"===o.type;let l=!1;if(0===o.vertices.length)continue;const h=new a.u9r;h.setAttribute("position",new a.a$l(o.vertices,3)),o.normals.length>0&&h.setAttribute("normal",new a.a$l(o.normals,3)),o.colors.length>0&&(l=!0,h.setAttribute("color",new a.a$l(o.colors,3))),!0===o.hasUVIndices&&h.setAttribute("uv",new a.a$l(o.uvs,2));const u=[];for(let t=0,i=s.length;t<i;t++){const i=s[t],o=i.name+"_"+i.smooth+"_"+l;let c=e.materials[o];if(null!==this.materials)if(c=this.materials.create(i.name),!n||!c||c instanceof a.nls){if(r&&c&&!(c instanceof a.UY4)){const t=new a.UY4({size:10,sizeAttenuation:!1});a.F5T.prototype.copy.call(t,c),t.color.copy(c.color),t.map=c.map,c=t}}else{const t=new a.nls;a.F5T.prototype.copy.call(t,c),t.color.copy(c.color),c=t}void 0===c&&(c=n?new a.nls:r?new a.UY4({size:1,sizeAttenuation:!1}):new a.xoR,c.name=i.name,c.flatShading=!i.smooth,c.vertexColors=l,e.materials[o]=c),u.push(c)}let d;if(u.length>1){for(let t=0,e=s.length;t<e;t++){const e=s[t];h.addGroup(e.groupStart,e.groupCount,t)}d=n?new a.ejS(h,u):r?new a.woe(h,u):new a.Kj0(h,u)}else d=n?new a.ejS(h,u[0]):r?new a.woe(h,u[0]):new a.Kj0(h,u[0]);d.name=i.name,c.add(d)}else if(e.vertices.length>0){const t=new a.UY4({size:1,sizeAttenuation:!1}),i=new a.u9r;i.setAttribute("position",new a.a$l(e.vertices,3)),e.colors.length>0&&void 0!==e.colors[0]&&(i.setAttribute("color",new a.a$l(e.colors,3)),t.vertexColors=!0);const o=new a.woe(i,t);c.add(o)}return c}}var _=i(3458),k=i(1944);function U(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}var z=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.dom=e,this.opt=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?U(Object(i),!0).forEach((function(e){c(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):U(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({sceneUrl:"",modelUrl:"",autoRotate:!1,isFullBrowser:!0},i),this.scene=null,this.camera=null,this.renderer=null,this.controls=null,this.model=null,this.init()}var e,i,o;return e=t,(i=[{key:"init",value:function(){this.sceneInit(),this.cameraInit(),this.renderInit(),this.controlsInit(),this.animate(),this.opt.sceneBg&&(this.scene.background=(new a.dpR).load(this.opt.sceneBg)),this.opt.sceneUrl&&this.loadScene(this.opt.sceneUrl),this.opt.modelUrl&&this.loadModel(this.opt.modelUrl),this.opt.isFullBrowser&&window.addEventListener("resize",this.onWindowResize.bind(this))}},{key:"sceneInit",value:function(){var t=this;this.scene=new a.xsS,this.opt.lights.map((function(e){var i;e.obj.name=e.name,e.position&&(i=e.obj.position).set.apply(i,(0,l.Z)(e.position)),e.Helper=new a.xG9(e.obj),t.scene.add(e.obj)}))}},{key:"cameraInit",value:function(){this.camera=new a.cPb(70,this.getWidth()/this.getHeight(),.01,1e4),this.camera.position.set(0,2,5)}},{key:"renderInit",value:function(){this.renderer=new a.CP7({antialias:!0,alpha:!0}),this.renderer.setSize(this.getWidth(),this.getHeight()),this.renderer.setPixelRatio(window.devicePixelRatio),this.dom.appendChild(this.renderer.domElement)}},{key:"controlsInit",value:function(){this.controls=new u.z(this.camera,this.renderer.domElement),this.controls.autoRotateSpeed=1,this.controls.autoRotate=this.autoRotate,this.controls.enableDamping=!0,this.controls.dampingFactor=.2,this.controls.rotateSpeed=.25,this.controlsRotate(this.opt.autoRotate),this.controls.update()}},{key:"controlsRotate",value:function(t){var e=this;if(this.controls.autoRotate=t||!1,t){var i=null;this.controls.addEventListener("start",(function(){i&&clearTimeout(i),e.controls.autoRotate=!1})),this.controls.addEventListener("end",(function(){i=setTimeout((function(){e.controls.autoRotate=!0,e.controls.update()}),3e3)}))}}},{key:"animate",value:function(){var t=this;requestAnimationFrame((function(){t.animate()})),this.controls.update(),this.renderer.render(this.scene,this.camera)}},{key:"loadScene",value:function(t){var e=this;/\.hdr$/i.test(t)?(new k.x).load(t,(function(t){t.mapping=a.dSO,e.scene.background=t,e.scene.environment=t})):/\.(jpg|jpeg|png|gif|bmp)$/i.test(t)&&(new a.dpR).load(t,(function(t){t.mapping=a.dSO,t.wrapS=a.rpg,t.wrapT=a.rpg,e.scene.background=t,e.scene.environment=t}))}},{key:"loadModel",value:function(t){var e=this,i=this.addLoadTip();/\.gltf$/i.test(t)?(new d.E).load(t,(function(t){i.textContent="加载完成！",e.model&&e.scene.remove(e.model);var o=t.scene;e.adjustModel(o),e.model=o,e.scene.add(e.model),setTimeout((function(){i.style.display="none"}),1e3)}),(function(t){i.textContent=parseInt(t.loaded/t.total*100)+"%加载中..."}),(function(t){i.textContent="模型加载失败！"})):/\.obj$/i.test(t)?(new V).load(t,(function(t){i.textContent="加载完成！",e.model&&e.scene.remove(e.model),e.adjustModel(t),e.model=t,e.scene.add(e.model),setTimeout((function(){i.style.display="none"}),1e3)}),(function(t){i.textContent=parseInt(t.loaded/t.total*100)+"%加载中..."}),(function(t){i.textContent="模型加载失败！"})):/\.fbx$/i.test(t)&&(new _.y).load(t,(function(t){i.textContent="加载完成！",e.model&&e.scene.remove(e.model),e.adjustModel(t),e.model=t,e.scene.add(e.model),setTimeout((function(){i.style.display="none"}),1e3)}),(function(t){i.textContent=parseInt(t.loaded/t.total*100)+"%加载中..."}),(function(t){i.textContent="模型加载失败！"}))}},{key:"adjustModel",value:function(t){var e=(new a.ZzF).setFromObject(t),i=new a.Pa4;e.getSize(i),t.position.y=-i.y/4;var o=(i.x+i.y+i.z)/3;this.camera.position.set(0,0,o),this.camera.updateProjectionMatrix(),this.setScaleToFitSize(t),this.ModelAutoCenter(t)}},{key:"onWindowResize",value:function(){this.camera.aspect=this.getWidth()/this.getHeight(),this.camera.updateProjectionMatrix(),this.renderer.setSize(this.getWidth(),this.getHeight())}},{key:"getWidth",value:function(){return this.opt.isFullBrowser?window.innerWidth:this.dom.offsetWidth}},{key:"getHeight",value:function(){return this.opt.isFullBrowser?window.innerHeight:this.dom.offsetHeight}},{key:"ModelAutoCenter",value:function(t){var e=new a.ZzF;e.expandByObject(t);var i=new a.Pa4;e.getCenter(i),t.position.x=t.position.x-i.x,t.position.y=t.position.y-i.y,t.position.z=t.position.z-i.z}},{key:"getFitScaleValue",value:function(t){var e=new a.fQA(t);e.geometry.computeBoundingBox();var i=e.geometry.boundingBox,o=Math.max(i.max.x-i.min.x,i.max.y-i.min.y,i.max.z-i.min.z);return this.camera.position.z/o}},{key:"setScaleToFitSize",value:function(t){var e=.5*this.getFitScaleValue(t);return t.scale.set(e,e,e),e}},{key:"addLoadTip",value:function(){var t=document.querySelector("body");document.querySelector(".loadTip")&&t.removeChild(document.querySelector(".loadTip"));var e=document.createElement("div");return e.className="loadTip",e.style.cssText+="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);border-radius:5px;background-color:rgba(0,0,0,0.5);padding:5px 10px;color:#fff;",t.appendChild(e),e}}])&&h(e.prototype,i),o&&h(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();const S={props:{sceneUrl:{type:String,required:!1},modelUrl:{type:String},autoRotate:{type:Boolean,default:!1},isFullBrowser:{type:Boolean,default:!0},sceneBg:{type:String,default:""},lights:{type:Array,default:function(){return[{name:"AmbientLight",obj:new a.Mig(16777215,1)},{name:"DirectionalLight",obj:new a.Ox3(16777215,1),position:[80,100,50]}]}}},data:function(){return{threeView:null}},watch:{sceneUrl:function(t){this.threeView.loadScene(t)},modelUrl:function(t){this.threeView.loadModel(t)},autoRotate:function(t){this.threeView.controlsRotate(t)}},mounted:function(){this.threeView=new z(this.$el,{sceneUrl:this.sceneUrl,modelUrl:this.modelUrl,autoRotate:this.autoRotate,isFullBrowser:this.isFullBrowser,sceneBg:this.sceneBg,lights:this.lights})}};var F=i(5471),I=(0,F.Z)(S,r,[],!1,null,null,null);I.options.__file="src/components/three/three-view.vue";const T=I.exports;var O=i(8496);const P={name:"",components:{ThreeView:T,Tutorial:n.Z},data:function(){return{BG:O,baseUrl:"static/models/",modelUrl:"",lights:[{type:"AmbientLight",color:"0xffffff",intensity:1},{type:"DirectionalLight",position:{x:80,y:100,z:50},color:16777215,intensity:1}],modelText:{title:"",subTitle:"这是一个古董"},showTip:!0,dialogVisible:!1,autoRotate:!1}},methods:{},watch:{$route:{handler:function(t,e){var i=this.baseUrl;t.query.name?(this.modelUrl="".concat(i).concat(t.query.name,".fbx"),this.modelText.title=t.query.name):this.$message.warning("请输入模型名称")},deep:!0,immediate:!0}}};var R=(0,F.Z)(P,o,s,!1,null,"8ec3482e",null);R.options.__file="src/views/sdt2.vue";const L=R.exports},8496:(t,e,i)=>{t.exports=i.p+"static/images/8e4fe26be1ecf22c0d5d.jpg"}}]);
//# sourceMappingURL=chunk-b90cb8f35f6817f9a074.js.map